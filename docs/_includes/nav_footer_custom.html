<button class="btn js-toggle-dark-mode">Theme: System</button>

<script>
(function() {
  var toggleBtn = document.querySelector('.js-toggle-dark-mode');
  var modes = ['system', 'light', 'dark'];
  var labels = { system: 'System', light: 'Light', dark: 'Dark' };

  function getSystemTheme() {
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  function applyMode(mode) {
    var theme = (mode === 'system') ? getSystemTheme() : mode;
    jtd.setTheme(theme);
    toggleBtn.textContent = 'Theme: ' + labels[mode];
    localStorage.setItem('theme-mode', mode);
  }

  // Initialize
  var currentMode = localStorage.getItem('theme-mode') || 'system';
  applyMode(currentMode);

  // Listen for system preference changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
    if (localStorage.getItem('theme-mode') === 'system') {
      jtd.setTheme(getSystemTheme());
    }
  });

  // Cycle through modes on click
  jtd.addEvent(toggleBtn, 'click', function() {
    var current = localStorage.getItem('theme-mode') || 'system';
    var nextIndex = (modes.indexOf(current) + 1) % modes.length;
    applyMode(modes[nextIndex]);
  });
})();
</script>
